+++
draft = false
date = "2007-04-19T19:58:14-03:00"
title = "Passing data to viewlets from the parent template"
tags = ["zope3", "cookbook"]
created = "2007-04-19T19:10:36-03:00"
modified = "2007-04-20T11:40:21-03:00"
permaLink = "http://play.pixelblaster.ro/blog/archive/2007/04/19/passing-data-to-viewlets-from-the-parent-template"
author = "Tiberiu Ichim"
aliases = [
    "/blog/archive/2007/04/19/passing-data-to-viewlets-from-the-parent-template"
]
+++

<p>To insert a rendered viewlet manager into a page, one uses something like "tal:replace="structure provider: ILeftSide". Of course, viewlet managers are providers, they implement the IContentProvider interface and are looked up with this interface in the 'provider' TALES handler. One particular trick that content providers do is that they allow insertion of TAL data from the template, to make it accessible inside the content provider class. A sort of "parameters", as it is detailed in the README.txt file, chapter "Additional data from TAL". Things are a bit more complicated for the viewlet managers, because the viewlet manager object is created with a new type at runtime, a type which inherits only the minimum information from the new viewlet manager interface. The only way to make the created viewlet manager provide a new interface (as required by the TALESProviderExpression to insert data from the context) is to subclass ViewletManagerBase and use this class as the factory class for the viewlet manager. I'm giving a simplified example, mostly inspired by the zope.contentprovider documentation:<br /></p><p>The viewlet manager interface,</p><pre>class ILeftSide(IViewletManager):<br />    """The left side"""<br /></pre><p>which is registered with: </p><pre>&lt;viewletManager name="ILeftSide" provides=".ILeftSide"<br />    class=".MessagePassingViewletManager" permission="zope.View" /&gt;<br /></pre><p>The viewlet manager is implemented with this new class:</p><pre>class MessagePassingViewletManager(ViewletManagerBase):<br />    implements(IMessage)<br /></pre><p>The class is, as I have found, a key component, because you need it to declare to implement a new interface, the IMessage:</p><pre>class IMessage(Interface):<br />    message = TextLine(u'Some message')<br /></pre><p>And the IMessage interface is declared as having a type, zope.contentprovider.interfaces.ITALNamespaceData</p><pre>&lt;zope:interface interface=".interfaces.IMessage"<br />    type="zope.contentprovider.interfaces.ITALNamespaceData" /&gt;<br /></pre><p>The idea is that all attributes specified in the IMessage interface can then be specified as attributes for the element that renders the viewlet manager in the template:</p><pre>&lt;div tal:define="message string:Hello World"<br />            tal:replace="structure provider:ILeftSide" /&gt;<br /></pre><p>Then, in any viewlet subscribed to the ILeftSide manager, you' can have:</p><pre>&lt;div tal:content="view/manager/message" /&gt;<br /></pre><p>which will render of course the 'Hello world' string. You can actually pass any object this way, there's no constraint imposed by the type defined in the interface schema, as I could tell from my tests.<br /></p>

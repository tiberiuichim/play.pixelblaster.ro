+++
draft = false
date = "2007-03-25T16:08:02-03:00"
title = "One issue using Prototype's Ajax form submission with Zope 3"
tags = ["zope3", "Javascript", "cookbook"]
created = "2007-03-25T15:28:14-03:00"
modified = "2007-03-25T19:50:38-03:00"
permaLink = "http://play.pixelblaster.ro/blog/archive/2007/03/25/one-issue-using-prototypes-ajax-form-submission-with-zope-3"
author = "Tiberiu Ichim"
aliases = [
    "/blog/archive/2007/03/25/one-issue-using-prototypes-ajax-form-submission-with-zope-3"
]
+++

<p>I've found a weird issue while trying to debug why on of my Ajax loaded forms wasn't, apparently, properly validated. Even though that the schema specified that the fields are required, the form action would get executed as if the validation wouldn't have been done or the request was properly validated. I thought at first that there's an issue with the form class/handling itself, but after some testing I came to the conclusion that it has to be the way I'm doing the AJAX request. <br /></p><p>What I have discovered is that I was using the <i>parameters</i> option of the Ajax.Request to make a form submit with POST method, which apparently causes Zope to validate the fields as having a value, even though they were empty. The right way to do this request is using the <i>postBody</i> parameter, as fixing that made my forms work again. I'm not sure what causes this behaviour in Zope: the visible difference is that postBody includes all the form inputs, even the empty ones, while the parameters version includes just those with a value (in my case, the submit button). And I have tried leaving out a field from the Zope request by saving the html page, deleting one of the inputs and doing a form submission, but Zope does the right thing in this case.</p><p>I'm not sure how popular is using the parameters option with POST and Ajax.Request, but I'm adding this note here, just in case.<br /></p><h3>postBody version <br /></h3><p>POST /++skin++course/site/new_design.html HTTP/1.1<br />Host: localhost:8080<br />User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.1) Gecko/20061024 Firefox/2.0 (Swiftfox)<br />Accept: text/javascript, text/html, application/xml, text/xml, */*<br />Accept-Language: en-us,en;q=0.7,ro;q=0.3<br />Accept-Encoding: gzip,deflate<br />Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7<br />Keep-Alive: 300<br />Connection: keep-alive<br />X-Requested-With: XMLHttpRequest<br />X-Prototype-Version: 1.5.1_rc1<br />Content-Type: application/x-www-form-urlencoded; charset=UTF-8<br />Referer: http://localhost:8080/++skin++course/site/<br />Content-Length: 94<br />Cookie: top_http___localhost_9080_t2_sticky_view=354px; left_http___localhost_9080_t2_sticky_view=646px; state_http___localhost_9080_t2_sticky_view=hide; zindex_http___localhost_9080_t2_sticky_view=5; WT_FPC=id=82.79.74.153-1913305056.29841814:lv=1172488789513:ss=1172484509013<br />Authorization: Basic dGliaTp2aWNlcm95<br />Pragma: no-cache<br />Cache-Control: no-cache<br />add_design.title=&amp;add_design.description=&amp;add_design.actions.4164642064657369676e=Add%20design<br />HTTP/1.x 200 OK<br />Content-Length: 4408<br />X-Powered-By: Zope (www.zope.org), Python (www.python.org)<br />Accept-Ranges: bytes<br />Server: Twisted/2.5.0+rUnknown TwistedWeb/[twisted.web2, version 0.2.0 (SVN rUnknown)]<br />Date: Sun, 25 Mar 2007 11:56:52 GMT<br />Content-Type: text/html;charset=utf-8<br />----------------------------------------------------------<br /></p><h3>parameters version</h3><br />POST /++skin++course/site/new_design.html HTTP/1.1<br />Host: localhost:8080<br />User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.1) Gecko/20061024 Firefox/2.0 (Swiftfox)<br />Accept: text/javascript, text/html, application/xml, text/xml, */*<br />Accept-Language: en-us,en;q=0.7,ro;q=0.3<br />Accept-Encoding: gzip,deflate<br />Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7<br />Keep-Alive: 300<br />Connection: keep-alive<br />X-Requested-With: XMLHttpRequest<br />X-Prototype-Version: 1.5.1_rc1<br />Content-Type: application/x-www-form-urlencoded; charset=UTF-8<br />Referer: http://localhost:8080/++skin++course/site/<br />Content-Length: 52<br />Cookie: top_http___localhost_9080_t2_sticky_view=354px; left_http___localhost_9080_t2_sticky_view=646px; state_http___localhost_9080_t2_sticky_view=hide; zindex_http___localhost_9080_t2_sticky_view=5; WT_FPC=id=82.79.74.153-1913305056.29841814:lv=1172488789513:ss=1172484509013<br />Authorization: Basic dGliaTp2aWNlcm95<br />Pragma: no-cache<br />Cache-Control: no-cache<br />add_design.actions.4164642064657369676e=Add%20design<br />HTTP/1.x 200 OK<br />Content-Length: 3491<br />X-Powered-By: Zope (www.zope.org), Python (www.python.org)<br />Accept-Ranges: bytes<br />Server: Twisted/2.5.0+rUnknown TwistedWeb/[twisted.web2, version 0.2.0 (SVN rUnknown)]<br />Date: Sun, 25 Mar 2007 11:56:15 GMT<br />Content-Type: text/html;charset=utf-8<br />----------------------------------------------------------<br />

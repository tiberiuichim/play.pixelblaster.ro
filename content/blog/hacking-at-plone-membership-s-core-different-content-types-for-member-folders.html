+++
draft = false
date = "2006-10-07T19:18:13-03:00"
title = "Hacking at Plone membership's core: different content types for member folders"
tags = ["cookbook", "Plone"]
created = "2006-10-07T19:05:42-03:00"
modified = "2006-10-10T16:18:19-03:00"
permaLink = "http://play.pixelblaster.ro/blog/archive/2006/10/07/hacking-at-plone-membership-s-core-different-content-types-for-member-folders"
author = "Tiberiu Ichim"
aliases = [
    "/blog/archive/2006/10/07/hacking-at-plone-membership-s-core-different-content-types-for-member-folders"
]
+++

<p>I'm using this technique for a site created with Plone 2.1, but it I think it can work on Plone 2.5 as well. Basically, I need a site with different membership types, and each membership type has a "personal area" (different member folder) where the user can add different object types and generally have a completely different browsing experience. I haven't implemented anything exotic such as CMFMember (not future proof) or membrane (not compatible, don't want to mess around yet) so I'm sticking with plain Plone users.</p><p>No 1 on the list is monkey patching MembershipTool to be able to specify more then one type of member folders. The module below (patch.py) also shows what monkey patching is about (look for clues at the end of the snippet):</p><pre>#patching below<br />from Products.CMFCore.utils import getToolByName<br />from Products.CMFPlone.utils import _createObjectByType<br />from AccessControl import ClassSecurityInfo, getSecurityManager<br />from Products.CMFPlone.MembershipTool import MembershipTool<br /><br />def createMemberarea(self, member_id=None, minimal=1, areaType=None):<br />    """<br />    Create a member area for 'member_id' or the authenticated user.<br />    areaType is a string that contains a portal type.<br />    """<br />...  &lt;SNIPED&gt;<br /><br />    if hasattr(members, member_id):<br />        # has already this member<br />        # TODO exception<br />        return<br /><br />    #START CHANGES<br />    if areaType is not None:<br />        memberarea_type = areaType<br />    else:<br />        memberarea_type = self.memberarea_type<br />    #END CHANGED<br /><br />    _createObjectByType(memberarea_type, members, id=member_id)<br /><br />...  &lt;SNIPED&gt;<br /><br />#monkeypatching<br /><br />print "Monkey patching Products.CMFPlone.MembershipTool.MembershipTool to provide aditional member folders types..."<br /><br />security = ClassSecurityInfo()<br /><br />security.declarePublic('createMemberarea')<br />MembershipTool.createMemberarea = createMemberarea<br />MembershipTool.createMemberArea = createMemberarea<br /><br />print "Done."<br /></pre><p>In the Product/__init__.py file add a simple 'import patch' to enable loading the patch.<br /></p><p>Because I've created a complete alternate login system (again, different user experiences, duplicating the plone_login folder seemed easier to get this running), it is easy for me to plug in the special member folder creation. I've customized logged_in.cpy to contain:<br /></p><pre>membership_tool.createMemberArea(areaType='ServiceProviderHome')</pre><p>instead of the usual <br /></p><pre>membership_tool.createMemberArea() </pre><p>I'm not feeling very smart for this site because of the complicated setup: monkey patching, duplicating plone_login, etc, but this is what it works and it's easiest for me right now. Perhaps the future Plone 3 will make this kind of things easier (extending the MembershipTool with new behaviour).<br /></p>
